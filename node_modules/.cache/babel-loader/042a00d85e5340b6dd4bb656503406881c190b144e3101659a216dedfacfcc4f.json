{"ast":null,"code":"import \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/popup/style\";\nimport _popup from \"vant/es/popup\";\nimport \"vant/es/picker/style\";\nimport _Picker from \"vant/es/picker\";\nimport \"vant/es/switch/style\";\nimport _Switch from \"vant/es/switch\";\nimport \"vant/es/nav-bar/style\";\nimport _NavBar from \"vant/es/nav-bar\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport { dizhi_liebiao_post, dizhi_xinzeng_post, dizhi_xiugai_post } from \"@/API/user\";\nimport NationalityList from \"@/components/NationalityList\";\nimport { apiListCountry, apiListState, apiListCity } from \"@/API/common\";\nimport de from \"@/i18n/de\";\nexport default {\n  data() {\n    return {\n      triangleDown: require(\"@/assets/image/me/triangle_down.png\"),\n      pageDiaCode: false,\n      dialCode: localStorage.getItem(\"dialCode\") || 1,\n      checked: true,\n      showCountryPicker: false,\n      showCityPicker: false,\n      showProvincePicker: false,\n      formData: {\n        contacts: \"\",\n        email: \"\",\n        phone: \"\",\n        country: \"\",\n        province: \"\",\n        city: \"\",\n        postcode: \"\",\n        address: \"\",\n        countryId: 0,\n        provinceId: 0,\n        cityId: 0\n      },\n      currentId: null,\n      cityList: [],\n      provinceList: [],\n      countryList: [],\n      countryId: 0,\n      provinceId: 0,\n      isProvince: true,\n      isCity: true,\n      currentCountryId: null\n    };\n  },\n  components: {\n    [_NavBar.name]: _NavBar,\n    [_Switch.name]: _Switch,\n    NationalityList,\n    [_Picker.name]: _Picker,\n    [_popup.name]: _popup\n  },\n  created() {\n    const {\n      id\n    } = this.$route.query;\n    if (id) {\n      this.currentId = id;\n      this.getAddressInfo();\n    }\n    this.getCountry();\n  },\n  methods: {\n    // 获取国家\n    async getCountry() {\n      const result = await apiListCountry();\n      this.countryList = result.data;\n    },\n    // 获取省/州\n    async getStateList(id) {\n      const res = await apiListState({\n        countryId: +id\n      });\n      this.provinceList = res.data;\n      if (this.provinceList.length == 0) {\n        this.isProvince = false;\n        this.provinceList = [{\n          stateName: this.$t(\"暂无数据\"),\n          id: \"\"\n        }];\n      }\n    },\n    // 获取市\n    async getListCity(id) {\n      const res = await apiListCity({\n        stateId: id\n      });\n      this.cityList = res.data;\n      if (this.cityList.length == 0) {\n        this.isCity = false;\n        this.cityList = [{\n          cityName: this.$t(\"暂无数据\"),\n          id: \"\"\n        }];\n      } else {\n        this.isCity = true;\n      }\n    },\n    // 城市change\n    onCityChange(value) {\n      this.cityList.find(item => {\n        if (item.cityName == value) {\n          this.formData.cityId = item.id;\n        }\n      });\n      this.formData.city = value;\n    },\n    // onCityConfirm(value) {\n    //     this.formData.city = value.cityName;\n    //     this.showCityPicker = false;\n    // },\n    onCityCancel() {\n      this.showCityPicker = false;\n    },\n    // 选择国家\n    // onCountryConfirm(value) {\n    //     this.formData.country = value.countryName;\n    //     this.countryId = value.id;\n    //     this.isProvince = true;\n    //     this.isCity = true;\n    //     this.showCountryPicker = false;\n    //     this.currentCountryId = value.id;\n    //     // 查看有没有省\n    //     this.getStateList(value.id);\n    // },\n    onCountryChange(value) {\n      this.countryList.find(item => {\n        if (item.countryName == value) {\n          this.formData.country = value;\n          this.formData.countryId = item.id;\n          this.currentCountryId = this.countryId = item.id;\n          this.isProvince = true;\n          this.showCountryPicker = false;\n          this.getStateList(item.id);\n        }\n      });\n      this.formData.city = this.formData.province = \"\";\n      this.formData.cityId = this.formData.provinceId = 0;\n      // this.formData.country = value.countryName;\n      // this.countryId = value.id;\n      // this.isProvince = true;\n      // this.isCity = true;\n      // this.showCountryPicker = false;\n      // this.currentCountryId = value.id;\n      // // 查看有没有省\n      // this.getStateList(value.id);\n    },\n    onCountryCancel() {\n      this.showCountryPicker = false;\n    },\n    // onProvinceConfirm(value) {\n    //     this.formData.province = value.stateName;\n    //     this.provinceId = value.id;\n    //     this.showProvincePicker = false;\n    //     this.getListCity(value.id);\n    // },\n    onProvinceChange(value) {\n      this.provinceList.find(item => {\n        if (item.stateName == value) {\n          this.formData.province = value;\n          this.formData.provinceId = item.id;\n          this.provinceId = item.id;\n          this.showProvincePicker = false;\n          this.getListCity(item.id);\n        }\n      });\n      this.formData.city = '';\n    },\n    onProvinceCancel() {\n      this.showProvincePicker = false;\n    },\n    clickCountry() {\n      document.activeElement.blur();\n      this.showCountryPicker = true;\n      this.formData.province = \"\";\n      this.formData.city = \"\";\n    },\n    ProvincePicker() {\n      document.activeElement.blur();\n      this.formData.city = \"\";\n      // 选择省\n      if (this.formData.country == \"\") {\n        _Toast(this.$t(\"请输入\") + this.$t(\"国家\"));\n      } else {\n        this.getStateList(this.countryId);\n        this.showProvincePicker = true;\n      }\n    },\n    CityPicker() {\n      document.activeElement.blur();\n      if (this.formData.province == this.$t(\"暂无数据\")) {\n        this.formData.city = this.$t(\"暂无数据\");\n        // this.city\n      } else if (this.formData.country && this.formData.province) {\n        this.getListCity(this.provinceId);\n        this.showCityPicker = true;\n      } else {\n        _Toast(this.$t(\"请输入\") + this.$t(\"省区\"));\n      }\n    },\n    getAddressInfo() {\n      _Toast.loading({\n        duration: 0,\n        // message: this.$t(\"请求中\"),\n        forbidClick: true\n      });\n      dizhi_liebiao_post({}).then(res => {\n        _Toast.clear();\n        const {\n          pageList\n        } = res;\n        const address = pageList.find(item => String(item.id) === String(this.currentId));\n        if (address) {\n          this.checked = Boolean(address.use);\n          this.currentCountryId = address?.countryId;\n          if (address.phone.indexOf(\"|\") > -1) {\n            const arr = address.phone.split(\"|\");\n            this.dialCode = arr[0];\n            address.phone = arr[1];\n          }\n          delete address.use;\n          address?.countryId && this.getStateList(address.countryId);\n          address?.provinceId && this.getListCity(address.provinceId);\n          this.formData = {\n            ...address\n          };\n        }\n      }).catch(err => {\n        // Toast.fail(err.msg);\n      });\n    },\n    onClickLeft() {\n      this.$router.go(-1);\n    },\n    // 禁止input框输入表情\n    inputVal(type, e) {\n      let reg = /([0-9|*|#]\\uFE0F\\u20E3)|([0-9|#]\\u20E3)|([\\u203C-\\u3299]\\uFE0F\\u200D)|([\\u203C-\\u3299]\\uFE0F)|([\\u2122-\\u2B55])|(\\u303D)|([(\\A9)|(\\AE)]\\u3030)|(\\uA9)|(\\uAE)|(\\u3030)|([\\uD83C|\\uD83D|\\uD83E][\\uDC00-\\uDFFF])|([\\uD83C|\\uD83D|\\uD83E][\\uDC00-\\uDFFF][\\u200D|\\uFE0F])/g;\n      setTimeout(() => {\n        this.formData[type] = e.replace(reg, \"\");\n      }, 0);\n    },\n    getName(params) {\n      if (!this.pageDiaCode) {\n        this.pageDiaCode = true;\n      } else {\n        this.dialCode = params[2];\n        localStorage.setItem(\"dialCode\", this.dialCode);\n      }\n    },\n    openNational() {\n      this.$refs.controlChild.open();\n    },\n    handleInputChange(e) {\n      // 限制input只能输入数字\n      if (/^[1-9]\\d*$|^$/.test(e)) {\n        this.formData.phone = e;\n      }\n    },\n    submitHandle() {\n      if (this.formData.contacts === \"\") {\n        _Toast(this.$t(\"请输入\") + this.$t(\"名称\"));\n        return;\n      }\n      if (this.formData.email === \"\") {\n        _Toast(this.$t(\"请输入\") + this.$t(\"邮箱\"));\n        return;\n      } else {\n        const reg = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}$/;\n        if (!reg.test(this.formData.email)) {\n          console.log(`this.formData.email ::->`, this.formData.email);\n          _Toast(this.$t(\"邮箱格式有误\"));\n          return;\n        }\n      }\n      if (this.formData.phone === \"\") {\n        _Toast(this.$t(\"请输入\") + this.$t(\"手机号\"));\n        return;\n      } else {\n        const reg = /^[0-9]+[0-9]*$/;\n        if (!reg.test(this.formData.phone)) {\n          _Toast(this.$t(\"手机号格式有误\"));\n          return;\n        }\n      }\n      if (this.formData.country === \"\") {\n        _Toast(this.$t(\"请输入\") + this.$t(\"国家\"));\n        return;\n      }\n      // if (this.formData.province === \"\") {\n      //   Toast(this.$t(\"请输入\") + this.$t(\"省区\"));\n      //   return;\n      // }\n      // if (this.formData.city === \"\") {\n      //   Toast(this.$t(\"请输入\") + this.$t(\"市\"));\n      //   return;\n      // }\n      if (this.formData.postcode === \"\") {\n        // Toast(this.$t(\"请输入\") + this.$t(\"邮编\"));\n        this.$notifyWarn(this.$t(\"请输入\") + this.$t(\"邮编\"));\n        return;\n      }\n      if (this.formData.address === \"\") {\n        // Toast(this.$t(\"请输入\") + this.$t(\"收件地址\"));\n        this.$notifyWarn(this.$t(\"请输入\") + this.$t(\"收件地址\"));\n        return;\n      }\n      if (this.isProvince && this.formData.province == '') {\n        // Toast(this.$t(\"请选择\") + this.$t(\"省区\"));\n        this.$notifyWarn(this.$t(\"请选择\") + this.$t(\"省区\"));\n        return;\n      }\n      if (this.isProvince && this.isCity && this.formData.city == '') {\n        // Toast(this.$t(\"请选择\") + this.$t(\"市\"));\n        this.$notifyWarn(this.$t(\"请选择\") + this.$t(\"市\"));\n        return;\n      }\n      const params = {\n        ...this.formData,\n        countryId: this.currentCountryId,\n        phone: `${this.dialCode}|${this.formData.phone}`,\n        use: this.checked ? 1 : 0\n      };\n      params.province == '' && delete params.province;\n      params.city == '' && delete params.city;\n      let ajaxFn = dizhi_xinzeng_post;\n      if (this.currentId) {\n        params.id = this.currentId;\n        ajaxFn = dizhi_xiugai_post;\n      }\n      _Toast.loading({\n        duration: 0,\n        message: this.$t(\"提交中\"),\n        forbidClick: true\n      });\n      ajaxFn(params).then(() => {\n        _Toast.success(this.$t(\"保存成功\"));\n        setTimeout(() => {\n          this.$router.go(-1);\n        }, 500);\n      }).catch(err => {\n        _Toast.clear();\n        // Toast.fail(err.msg);\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}