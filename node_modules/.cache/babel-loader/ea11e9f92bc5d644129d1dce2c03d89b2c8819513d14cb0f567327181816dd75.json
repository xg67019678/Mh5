{"ast":null,"code":"import \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/icon/style\";\nimport _Icon from \"vant/es/icon\";\nimport \"vant/es/popup/style\";\nimport _Popup from \"vant/es/popup\";\nimport \"vant/es/cell-group/style\";\nimport _CellGroup from \"vant/es/cell-group\";\nimport \"vant/es/cell/style\";\nimport _Cell from \"vant/es/cell\";\nimport \"vant/es/stepper/style\";\nimport _Stepper from \"vant/es/stepper\";\nimport \"vant/es/checkbox-group/style\";\nimport _CheckboxGroup from \"vant/es/checkbox-group\";\nimport \"vant/es/checkbox/style\";\nimport _Checkbox from \"vant/es/checkbox\";\nimport \"vant/es/pull-refresh/style\";\nimport _PullRefresh from \"vant/es/pull-refresh\";\nimport \"vant/es/list/style\";\nimport _List from \"vant/es/list\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { dizhi_liebiao_post } from \"@/API/user\";\nimport { orderSubmit } from \"@/API/commodity\";\nimport { ref } from \"vue\";\nimport { priceFormat } from '@/utils/utis';\n// import EnterPassword from \"@/components/EnterPassword/index.vue\";\nimport Big from 'big.js';\nexport default {\n  setup() {\n    const checked = ref([\"a\", \"b\"]);\n    const checkedAll = ref(false);\n    const checkboxGroup = ref(null);\n    const checkAll = () => {\n      checkboxGroup.value.toggleAll(true);\n    };\n    return {\n      checked,\n      checkedAll,\n      checkAll,\n      checkboxGroup\n    };\n  },\n  data() {\n    return {\n      priceFormat,\n      type: 2,\n      //1直接购买,2购物车购买\n      goodsInfo: {},\n      //单个商品信息\n      bugNum: 1,\n      //单个商品选中的数量\n      refreshing: false,\n      paymentChecked: [],\n      checkboxList: [{\n        key: 0,\n        title: \"Blance\",\n        icon: \"\",\n        open: true\n      }, {\n        key: 1,\n        title: \"PayPal\",\n        icon: \"\",\n        open: false\n      }, {\n        key: 2,\n        title: \"Visa\",\n        icon: \"\",\n        open: false\n      }, {\n        key: 3,\n        title: \"Masercard\",\n        icon: \"\",\n        open: false\n      }],\n      list: [],\n      addressList: [],\n      addressInfo: {},\n      orderList: [],\n      total: {},\n      //金额计算数据\n      skuId: \"\",\n      attributes: [],\n      currentCoverImg: '',\n      maxBuyNum: localStorage.getItem('maxBuyNum') || 500\n    };\n  },\n  components: {\n    [_List.name]: _List,\n    [_PullRefresh.name]: _PullRefresh,\n    [_Checkbox.name]: _Checkbox,\n    [_CheckboxGroup.name]: _CheckboxGroup,\n    [_Stepper.name]: _Stepper,\n    [_Cell.name]: _Cell,\n    [_CellGroup.name]: _CellGroup,\n    [_Popup.name]: _Popup,\n    [_Icon.name]: _Icon,\n    [_Toast.name]: _Toast\n  },\n  created() {\n    //获取路由参数\n    try {\n      let {\n        type,\n        goodsInfo,\n        bugNum,\n        currentCoverImg\n      } = this.$route.query;\n      this.currentCoverImg = currentCoverImg;\n      this.type = type;\n      this.goodsInfo = JSON.parse(goodsInfo);\n      this.bugNum = bugNum;\n    } catch (e) {\n      console.log(e);\n    }\n    this.dizhiliebiao();\n    //跳转商品展示\n    this.getProduct();\n    this.init();\n  },\n  methods: {\n    init() {\n      //全选\n      if (this.list.length > 0) {\n        this.list.forEach(item => {\n          item.checkedAll = true;\n          if (item.child.length > 0) {\n            item.checkedValue = item.child.map(child => child?.tempId);\n          }\n        });\n      }\n      //计算总金额\n      this.mathMoney();\n    },\n    mathMoney() {\n      this.total = {\n        money: 0,\n        piece: 0,\n        discount: 0,\n        freight: 0,\n        goodsTax: 0,\n        mathMoney: 0,\n        discountPrice: 0\n      };\n      let count = 0;\n      this.list.forEach(item => {\n        count += item.checkedValue.length;\n        // this.total.piece = item.checkedValue.length\n        item.child.length > 0 && item.child.forEach(child => {\n          //num<item.moreNum&&\n          if (item.checkedValue.includes(child.tempId)) {\n            this.total.money = this.$plus(this.total.money, this.$operation(child.price, child.count, 'times'));\n            this.total.freight = this.$plus(this.total.freight, this.$operation(child.freightAmount, child.count, 'times'));\n            this.total.goodsTax = this.$plus(this.total.goodsTax, this.$operation(child.goodsTax, child.count, 'times'));\n          }\n        });\n      });\n      this.total.piece = count;\n      this.total.mathMoney = new Big(this.total.money).plus(this.total.freight).plus(this.total.goodsTax).minus(this.total.discount);\n      this.total.mathMoney = priceFormat(this.total.mathMoney);\n    },\n    getProduct() {\n      if (this.type == 1) {\n        if (this.$route.query.skuId !== \"-1\") {\n          this.skuId = this.$route.query.skuId || 0;\n          this.attributes = this.goodsInfo.canSelectAttributes.skus.filter(i => i.skuId == this.skuId)[0];\n          this.attributes = this.attributes.attrs;\n        }\n        console.log(`this.goodsInfo ::->`, this.goodsInfo);\n        // console.log(\"attributes ->\", attributes);\n        let item = {\n          key: 0,\n          sort: this.goodsInfo.seller.name,\n          checkedAll: false,\n          checkedValue: [],\n          moreNum: 2,\n          child: [{\n            key: 1,\n            img: this.goodsInfo.imgUrl1 || this.$defaultGoodsImage,\n            price: this.goodsInfo.discountPrice ? this.goodsInfo.discountPrice : this.goodsInfo.sellingPrice,\n            describe: this.goodsInfo.name,\n            attributes: this.attributes || [],\n            count: this.bugNum,\n            id: this.goodsInfo.id,\n            freightAmount: this.goodsInfo.freightAmount,\n            goodsTax: this.goodsInfo.goodsTax\n          }]\n        };\n        this.list.push(item);\n      } else {\n        //   console.log(\"this.goodsInfo ->\", this.list);\n        this.list = this.$ls.get(\"cartList\");\n      }\n    },\n    // 单选\n    handlecheckItemClick(item, index, n) {\n      if (this.list[index].child[n].selected == undefined) this.list[index].child[n].selected = true;\n      this.list[index].child[n].selected = !this.list[index].child[n].selected;\n      let count = 0;\n      let num = 0;\n      let len = this.list[index].child.length;\n      this.list[index].child.forEach(sub => {\n        if (sub.selected) count += 1;else num += 1;\n        if (num == len) this.list[index].checkedAll = false;\n        if (count == len) this.list[index].checkedAll = true;\n      });\n    },\n    //类全选\n    handleCheckItemAll(value, index) {\n      this.list[index].checkedValue = [];\n      this.$nextTick(() => {\n        this.list[index].child.forEach((item, num) => {\n          item.selected = value;\n          value && this.list[index].checkedValue.push(item.tempId);\n        });\n      });\n      // this.list[index].checkedValue = [];\n      // if (value) {\n      //   this.list[index].child.forEach((item, num) => {\n      //     if (num < this.list[index].moreNum) {\n      //       this.list[index].checkedValue.push(item.id);\n      //     }\n      //   });\n      // }\n      this.mathMoney();\n    },\n    onRefresh() {\n      // 清空列表数据\n      this.finished = false;\n      this.loading = true;\n      this.onLoad();\n    },\n    onLoad() {\n      if (this.refreshing) {\n        this.refreshing = false;\n      }\n    },\n    onClickLeft() {\n      this.$router.go(-1);\n      // this.$router.push({ path: \"/cart\" });\n    },\n    // 确认\n    handleConfri() {\n      if (!(this.total.piece > 0)) {\n        _Toast(this.$t(\"请选择要购买的商品\"));\n        return;\n      }\n      let dataJson = {\n        orderInfo: \"\",\n        addressId: this.addressInfo.id\n      };\n      if (this.$route.query?.isCart) {\n        dataJson.fromCart = 1;\n      }\n      if (this.type == 1) {\n        dataJson.orderInfo = `${this.goodsInfo.id},${this.$route.query.skuId || \"-1\"},${this.list[0].child[0].count}`;\n      } else {\n        this.list.forEach(item => {\n          item.child.length > 0 && item.child.forEach(child => {\n            if (item.checkedValue.includes(child.tempId)) {\n              dataJson.orderInfo += `${child.id},${child?.skuId || \"-1\"},${child.count},`;\n            }\n          });\n        });\n      }\n      orderSubmit(dataJson).then(res => {\n        this.orderList = res.orderList;\n        let productList = this.$ls.get(\"productList\") || [];\n        let ids = [];\n        productList?.forEach(item => {\n          this.list.forEach(({\n            child\n          }) => {\n            child.forEach(({\n              id,\n              selected\n            }) => {\n              if (id == item.id && selected) ids.push(id);\n            });\n          });\n        });\n        this.$store.state.qiangdan.count = this.$store.state.qiangdan.count - 1;\n        localStorage.setItem(\"CART_NUM\", this.$store.state.qiangdan.count);\n        this.$router.push({\n          path: \"/PendingPayment\",\n          query: {\n            orderList: JSON.stringify(this.orderList),\n            total: this.total.mathMoney,\n            ids,\n            isCart: this.$route.query?.isCart || 0\n          }\n        });\n        // this.pwtStatus=true\n      });\n    },\n    //获取地址列表\n    dizhiliebiao() {\n      dizhi_liebiao_post({}).then(res => {\n        if (!res.pageList?.[0]?.country) return;\n        this.addressList = res.pageList;\n        let address = JSON.parse(this.$ls.get(\"address\"));\n        if (address) {\n          this.addressInfo = address;\n          this.$ls.remove(\"address\");\n          return;\n        }\n        this.addressList.map(item => {\n          item.phone = item.phone.indexOf(\"|\") > -1 ? item.phone.split(\"|\")[1] : item.phone;\n          if (item.use === 1) {\n            this.addressInfo = item;\n          }\n        });\n      }).catch(() => {});\n    },\n    openAddress() {\n      this.$router.push(\"/AddressList?c=1\");\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}