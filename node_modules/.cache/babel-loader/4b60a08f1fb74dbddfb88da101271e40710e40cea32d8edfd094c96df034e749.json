{"ast":null,"code":"import \"vant/es/dialog/style\";\nimport _Dialog from \"vant/es/dialog\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/nav-bar/style\";\nimport _NavBar from \"vant/es/nav-bar\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport CancelDialog from \"./../components/CancelDialog.vue\";\nimport RemindsDialog from \"./../components/RemindsDialog.vue\";\nimport { priceFormat } from \"@/utils/utis\";\nimport { orderInfo, orderListGoods, orderReceipt } from \"@/API/user\";\nexport default {\n  name: \"OrderDetails\",\n  components: {\n    [_NavBar.name]: _NavBar,\n    [_Toast.name]: _Toast,\n    [_Dialog.name]: _Dialog,\n    CancelDialog,\n    RemindsDialog\n  },\n  data() {\n    return {\n      copyIcon: require(\"@/assets/image/me/fuzhi1.png\"),\n      cancelShow: false,\n      remindShow: false,\n      currentData: null,\n      orderId: null,\n      totalPrice: 0,\n      goodsData: [],\n      timezone: \"\"\n    };\n  },\n  computed: {\n    goodsTotalNum() {\n      let num = 0;\n      this.goodsData.forEach(item => {\n        num += item.goodsNum;\n      });\n      return num;\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {\n      const {\n        id\n      } = this.$route.query;\n      if (id) {\n        this.orderId = id;\n        this.getDataInfo();\n        this.getOrderGoods();\n      } else {\n        _Toast(this.$t(\"订单号不存在\"));\n        setTimeout(() => {\n          this.$router.back();\n        }, 1500);\n      }\n    });\n    this.timezone = localStorage.getItem(\"timeZone\");\n  },\n  methods: {\n    repeatPurchase(item) {\n      if (item?.isShelf != 1 || item?.isValid != 1) return this.$notify(this.$t('该商品已下架'), 'warning');\n      this.$router.push('/CommodityDetails?sellerGoodsId=' + item.goodsId);\n    },\n    time(t) {\n      let dayjs = this.dayjs;\n      return dayjs().tz(this.timezone).format(t);\n    },\n    priceFormat(num) {\n      return priceFormat(num);\n    },\n    copyHandle(txt) {\n      this.$copyText(txt).then(() => {\n        _Toast(this.$t(\"复制成功\"));\n      }, () => {\n        _Toast(this.$t(\"复制失败\"));\n      });\n    },\n    getDataInfo() {\n      _Toast.loading({\n        duration: 0,\n        // message: this.$t(\"请求中\"),\n        forbidClick: true\n      });\n      orderInfo({\n        orderId: this.orderId,\n        type: 1\n      }).then(res => {\n        this.currentData = res.orderInfo;\n        _Toast.clear();\n      }).catch(() => {\n        _Toast.clear();\n      });\n    },\n    getOrderGoods() {\n      orderListGoods({\n        orderId: this.orderId\n      }).then(res => {\n        this.goodsData = res.pageList || [];\n        this.goodsData.forEach(item => {\n          this.totalPrice += item.goodsReal * item.goodsNum;\n          // this.$operation(this.totalPrice, this.$operation(item.goodsReal, item.goodsNum, 'plus'), 'times')\n          // this.totalPrice += this.$operation(item.goodsReal, item.goodsNum, 'times');\n        });\n      });\n    },\n    //跳转待支付页面\n    openPeddingPay(data) {\n      const list = [{\n        orderList: data.id\n      }];\n      this.$router.push({\n        path: \"/PendingPayment\",\n        query: {\n          orderList: JSON.stringify(list),\n          total: this.$operation(data.discountPrice, data.goodsCount, 'times') || this.$operation(data.priceReal, data.goodsCount, 'times')\n        }\n      });\n    },\n    // 提醒发货\n    remindHandle(data) {\n      const remindStore = localStorage.getItem(\"remindStore\") ? JSON.parse(localStorage.getItem(\"remindStore\")) : [];\n      if (!remindStore.includes(data.id)) {\n        this.remindShow = true;\n      } else {\n        _Toast(this.$t(\"该订单已提醒过啦~\"));\n      }\n    },\n    openPage(path, query) {\n      const params = {\n        path\n      };\n      if (query) {\n        params.query = query;\n      }\n      this.$router.push(params);\n    },\n    // 收货\n    orderPick(data) {\n      _Dialog.confirm({\n        title: this.$t(\"提示\"),\n        message: this.$t(\"确认收货吗？\"),\n        confirmButtonText: this.$t(\"确认\"),\n        cancelButtonText: this.$t(\"取消\")\n      }).then(() => {\n        _Toast.loading({\n          duration: 0,\n          message: this.$t(\"提交中\"),\n          forbidClick: true\n        });\n        const params = {\n          orderId: data.id\n        };\n        orderReceipt(params).then(() => {\n          _Toast.clear();\n          this.currentData = null;\n          // this.tableChange();\n          this.getDataInfo();\n          // this.getOrderGoods();\n        }).catch(() => {\n          _Toast.clear();\n        });\n      }).catch(() => {\n        console.log(\"cancel\");\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}