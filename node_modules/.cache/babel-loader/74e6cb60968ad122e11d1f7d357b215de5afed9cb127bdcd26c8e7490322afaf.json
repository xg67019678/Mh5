{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { apiMessageList, apiSystemMessage, apiUnreadSystemMessage } from '@/API/common';\nimport { shourtTimeString } from '@/utils/utis';\nexport default {\n  name: \"CustomerService\",\n  data() {\n    return {\n      itemName: process.env.VUE_APP_ITEM_NAME,\n      messageList: [],\n      shourtTimeString,\n      notifyInfo: {},\n      timer: null,\n      unreadCount: 0\n    };\n  },\n  mounted() {\n    if (this.itemName == 'EShop') {\n      this.requestSystemMessage();\n      this.requestUnreadSystemMessage();\n    }\n    this.requestMessageList();\n    this.timer = setInterval(() => {\n      this.requestMessageList();\n    }, 5000);\n  },\n  methods: {\n    onClickLeft() {\n      // 返回\n      this.$router.push('/');\n    },\n    handleJump(item) {\n      localStorage.setItem(\"storeName\", item.username);\n      localStorage.setItem(\"sellerId\", item.partyid);\n      sessionStorage.setItem(\"shopName\", item.username);\n      sessionStorage.setItem(\"sellerId\", item.partyid);\n      setTimeout(() => {\n        this.$router.push(`/customerService2`);\n      }, 200);\n    },\n    handleJump2(path) {\n      if (!this.notifyInfo?.title) return this.$toast(this.$t('暂无系统消息'));\n      this.$router.push(path);\n    },\n    requestMessageList() {\n      apiMessageList().then(res => {\n        this.messageList = res;\n      });\n    },\n    // pageSize=10&pageNum=1&totalElements=-1&type=3&status=0&module=1&token=4b0179022cf04ad99322b54b34c71ec8&tz=Asia%2FShanghai&lang=cn\n    requestSystemMessage() {\n      apiSystemMessage({\n        module: 0,\n        type: 3,\n        status: 0,\n        pageSize: 1,\n        pageNum: 1,\n        totalElements: -1\n      }).then(res => {\n        if (res.elements.length == 0) {\n          this.notifyInfo = {};\n          return;\n        }\n        res.elements.forEach(item => {\n          if (item.title == 'Customer complaint success notification') {\n            const regex = /The (.*) that you complained, the reason for the complaint: (.*), after review by the system, the situation is true, and the store reputation points (\\d+) will be deducted./;\n            const matches = item.content.match(regex);\n            const storeName = matches[1];\n            let complaintReason = matches[2];\n            const creditScore = matches[3];\n            if (complaintReason == 'No delivery for a long time') {\n              complaintReason = '长时间不发货';\n            } else if (complaintReason == 'seller’s poor service attitude') {\n              complaintReason = '卖家服务态度恶劣';\n            } else if (complaintReason == 'seller’s transaction fraud') {\n              complaintReason = '卖家交易欺诈';\n            } else if (complaintReason == 'seller’s failure to fulfill promises') {\n              complaintReason = '卖家承诺不履行';\n            } else if (complaintReason == 'other') {\n              complaintReason = '其他';\n            }\n            item.complaintReason = complaintReason;\n            item.creditScore = creditScore;\n            item.storeName = storeName;\n          } else if (item.title == 'Customer complaint rejection notification') {\n            const regex = /The (.*) that you complained, the reason for the complaint: (.*), was rejected after review by the system, the reason for rejection: (.*)/;\n            const matches = item.content.match(regex);\n            const storeName = matches[1];\n            let complaintReason = matches[2];\n            const creditScore = matches[3];\n            if (complaintReason == 'No delivery for a long time') {\n              complaintReason = '长时间不发货';\n            } else if (complaintReason == 'seller’s poor service attitude') {\n              complaintReason = '卖家服务态度恶劣';\n            } else if (complaintReason == 'seller’s transaction fraud') {\n              complaintReason = '卖家交易欺诈';\n            } else if (complaintReason == 'seller’s failure to fulfill promises') {\n              complaintReason = '卖家承诺不履行';\n            } else if (complaintReason == 'other') {\n              complaintReason = '其他';\n            }\n            item.complaintReason = complaintReason;\n            item.creditScore = creditScore;\n            item.storeName = storeName;\n          }\n        });\n        this.notifyInfo = res.elements[0];\n        console.log(`this.notifyInfo ::->`, this.notifyInfo);\n      });\n    },\n    // 查询未读系统通知\n    requestUnreadSystemMessage() {\n      apiUnreadSystemMessage({\n        type: 3,\n        module: '0'\n      }).then(res => {\n        this.unreadCount = res.count;\n      });\n    }\n  },\n  unMounted() {\n    clearInterval(this.timer);\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}