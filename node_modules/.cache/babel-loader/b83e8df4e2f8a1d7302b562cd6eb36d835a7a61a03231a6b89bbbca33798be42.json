{"ast":null,"code":"import \"vant/es/icon/style\";\nimport _Icon from \"vant/es/icon\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"core-js/modules/es.array.push.js\";\nimport Vcode from \"vue-puzzle-vcode\";\nimport loginAxios from \"@/API/login\";\nimport NationalityList from \"@/components/NationalityList\";\nimport { isLogin } from \"@/utils/utis\";\n// import LineLoginButton from \"../../components/LineLoginButton/LineLoginButton.vue\";\nimport TiktokLogin from \"../../components/TiktokLogin/TiktokLogin.vue\";\nimport axios from \"axios\";\nexport default {\n  name: \"LoginPage\",\n  data() {\n    return {\n      isShelves: !process.env.VUE_APP_PUT_ON_SHELVES,\n      itemName: process.env.VUE_APP_ITEM_NAME,\n      TabShow: 2,\n      it: {\n        input1: \"\",\n        input2: \"\"\n      },\n      show: false,\n      img1: require(\"@/assets/image/slider/1.png\"),\n      img2: require(\"@/assets/image/slider/2.png\"),\n      img3: require(\"@/assets/image/slider/3.png\"),\n      img4: require(\"@/assets/image/slider/4.png\"),\n      img5: require(\"@/assets/image/slider/5.png\"),\n      triangleDown: require(\"@/assets/image/me/triangle_down.png\"),\n      pageDiaCode: false,\n      dialCode: 1\n    };\n  },\n  components: {\n    [_Toast.name]: _Toast,\n    [_Icon.name]: _Icon,\n    Vcode,\n    NationalityList,\n    // LineLoginButton,\n    TiktokLogin\n  },\n  created() {\n    if (isLogin() && this.$route.query.from == \"ldy\") {\n      this.$notify(this.$t(\"您已登录\"), \"success\");\n      this.$router.push({\n        path: \"/\"\n      });\n    }\n    const acc = JSON.parse(localStorage.getItem(\"ACCOUNT_INFO\"));\n    if (!acc) return;\n    this.TabShow = acc?.TabShow;\n    this.it.input1 = acc?.username;\n    this.dialCode = acc?.dialCode || 1;\n  },\n  methods: {\n    async tiktok(res) {\n      const {\n        data\n      } = await axios.post(\"https://login.tkshouppig.com/api.php\", {\n        code: res.code\n      });\n      let email = data.union_id + \"@tiktok.com\";\n      loginAxios.LineLoginApi({\n        userId: email\n      }).then(async ret => {\n        console.log(ret, \"ret\");\n        this.$notify(this.$t(\"登录成功\"), \"success\");\n        localStorage.setItem(\"token\", ret.token);\n        let timeZone = this.dayjs.tz.guess();\n        localStorage.setItem(\"timeZone\", timeZone);\n        await this.$store.dispatch(\"getUserInfo\");\n        if (this.$route.query.from == \"ldy\") {\n          this.$router.push({\n            path: \"/\"\n          });\n          return;\n        }\n        try {\n          if (\"/register\" == sessionStorage.getItem(\"upperLevel\")) {\n            this.$router.push({\n              path: \"/\"\n            });\n          } else {\n            this.$router.push({\n              path: \"/\"\n            });\n          }\n        } catch (error) {\n          this.$router.push({\n            path: \"/\"\n          });\n        }\n      }).catch(err => {\n        _Toast.clear();\n      });\n    },\n    async result(res) {\n      let email = res.sub + \"@line.com\";\n      loginAxios.LineLoginApi({\n        userId: email\n      }).then(async ret => {\n        console.log(ret, \"ret\");\n        this.$notify(this.$t(\"登录成功\"), \"success\");\n        localStorage.setItem(\"token\", ret.token);\n        let timeZone = this.dayjs.tz.guess();\n        localStorage.setItem(\"timeZone\", timeZone);\n        await this.$store.dispatch(\"getUserInfo\");\n        if (this.$route.query.from == \"ldy\") {\n          this.$router.push({\n            path: \"/\"\n          });\n          return;\n        }\n        try {\n          if (\"/register\" == sessionStorage.getItem(\"upperLevel\")) {\n            this.$router.push({\n              path: \"/\"\n            });\n          } else {\n            this.$router.push({\n              path: \"/\"\n            });\n          }\n        } catch (error) {\n          this.$router.push({\n            path: \"/\"\n          });\n        }\n      }).catch(err => {\n        _Toast.clear();\n      });\n    },\n    fbLogin() {\n      let that = this;\n      FB.login(function (response) {\n        //確認登入成功\n        if (response.status === \"connected\") {\n          //取得使用者資料\n          FB.api(\"/me\", {\n            fields: \"name , email\"\n          },\n          //要取的資料\n          //要執行的事件，我這裡是將取得的資料傳到Vuex去執行\n          async function (response) {\n            console.log(response, \"res\");\n            loginAxios.LineLoginApi({\n              userId: response.email\n            }).then(async ret => {\n              that.$notify(that.$t(\"登录成功\"), \"success\");\n              localStorage.setItem(\"token\", ret.token);\n              let timeZone = that.dayjs.tz.guess();\n              localStorage.setItem(\"timeZone\", timeZone);\n              await that.$store.dispatch(\"getUserInfo\");\n              if (that.$route.query.from == \"ldy\") {\n                that.$router.push({\n                  path: \"/\"\n                });\n                return;\n              }\n              try {\n                if (\"/register\" == sessionStorage.getItem(\"upperLevel\")) {\n                  that.$router.push({\n                    path: \"/\"\n                  });\n                } else {\n                  that.$router.push({\n                    path: \"/\"\n                  });\n                }\n              } catch (error) {\n                that.$router.push({\n                  path: \"/\"\n                });\n              }\n            }).catch(err => {\n              _Toast.clear();\n            });\n            //  await store.dispatch(\"fetchFbUser\", response);\n          });\n        } else {\n          console.log(\"登入失敗\");\n        }\n      }, {\n        scope: \"email\"\n      });\n    },\n    handleJump() {\n      const path = this.$store.state.multiItem[process.env.VUE_APP_ITEM_NAME].customer_service;\n      if (path) {\n        if (window.plus) {} else {\n          window.open(path);\n        }\n      } else {\n        this.$router.push({\n          path: \"customerServiceIndex?path=customerService\"\n        });\n      }\n      // var url = 'https://ld.ebvsjbv.site/chat/#/customerServiceH5?lang='+this.$i18n.locale\n      // if (localStorage.getItem('token')){\n      //   url+='&token='+localStorage.getItem('token')\n      // }\n      // window.location.href=url\n    },\n    // gotoForget() {\n    //     this.$router.push({ path: \"forgetPassword\" });\n    // },\n    TabClick(e) {\n      this.it = {\n        input1: \"\",\n        input2: \"\"\n      };\n      this.TabShow = e;\n      const acc = JSON.parse(localStorage.getItem(\"ACCOUNT_INFO\"));\n      if (!acc) return;\n      if (acc.TabShow == e) {\n        this.TabShow = acc?.TabShow;\n        this.it.input1 = acc?.username;\n        this.dialCode = acc?.dialCode || 1;\n      }\n    },\n    post_form() {\n      const t = this;\n      if (this.TabShow === 1) {\n        if (this.it.input1 === \"\") {\n          _Toast(t.$t(\"请输入邮箱\"));\n          return;\n        } else {\n          const reg = /^([A-Za-z0-9_\\-\\.\\w{3,}])+\\@([A-Za-z0-9_\\-\\.])+\\.([A-Za-z]{2,4})$/;\n          if (!reg.test(this.it.input1)) {\n            _Toast(t.$t(\"邮箱格式有误\"));\n            return;\n          }\n        }\n      }\n      if (this.TabShow === 2) {\n        if (this.it.input1 === \"\") {\n          _Toast(t.$t(\"请输入手机号\"));\n          return;\n        } else {\n          const reg = /^[0-9]+[0-9]*$/;\n          if (!reg.test(this.it.input1)) {\n            _Toast(t.$t(\"手机号格式有误\"));\n            return;\n          }\n        }\n      }\n      if (this.it.input2 === \"\") {\n        _Toast(t.$t(\"请输入密码\"));\n        return;\n      }\n      if (this.itemName == \"Hive\") {\n        this.loginSubmit();\n      } else {\n        this.show = true;\n      }\n    },\n    onSuccess() {\n      this.loginSubmit();\n      this.show = false;\n    },\n    onFail() {\n      console.log(\"失败回调\");\n    },\n    loginSubmit() {\n      const params = {\n        password: encodeURI(this.it.input2)?.trim()\n      };\n      params.username = this.TabShow === 1 ? this.it.input1?.trim() : `${this.dialCode} ${this.it.input1?.trim()}`;\n      _Toast.loading({\n        duration: 0,\n        message: this.$t(\"提交中\"),\n        forbidClick: true\n      });\n      loginAxios.zhanghaodenglu(params).then(async res => {\n        if (this.TabShow == 2) {\n          localStorage.setItem(\"ACCOUNT_INFO\", JSON.stringify({\n            username: this.it.input1?.trim(),\n            dialCode: this.dialCode,\n            TabShow: 2\n          }));\n        } else {\n          localStorage.setItem(\"ACCOUNT_INFO\", JSON.stringify({\n            username: this.it.input1?.trim(),\n            TabShow: 1\n          }));\n        }\n        _Toast.clear();\n        // Toast.success(this.$t(\"登录成功\"));\n        this.$notify(this.$t(\"登录成功\"), \"success\");\n        localStorage.setItem(\"token\", res.token);\n        let timeZone = this.dayjs.tz.guess();\n        localStorage.setItem(\"timeZone\", timeZone);\n        await this.$store.dispatch(\"getUserInfo\");\n        if (this.$route.query.from == \"ldy\") {\n          this.$router.push({\n            path: \"/\"\n          });\n          return;\n        }\n        try {\n          if (\"/register\" == sessionStorage.getItem(\"upperLevel\")) {\n            this.$router.push({\n              path: \"/\"\n            });\n          } else {\n            this.$router.go(-1);\n          }\n        } catch (error) {\n          this.$router.push({\n            path: \"/\"\n          });\n        }\n      }).catch(err => {\n        _Toast.clear();\n      });\n    },\n    getName(params) {\n      if (!this.pageDiaCode) {\n        this.pageDiaCode = true;\n      } else {\n        this.dialCode = params[2];\n        localStorage.setItem(\"dialCode\", this.dialCode);\n      }\n    },\n    openNational() {\n      this.$refs.controlChild.open();\n    },\n    onClickLeft() {\n      this.$router.push(\"/\");\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}