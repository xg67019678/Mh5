{"ast":null,"code":"import \"vant/es/popup/style\";\nimport _Popup from \"vant/es/popup\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport { apigetCoinList, apiSubmitRecharge, apiPhpRecharge, apiGcash2Recharge, apiGcash3Recharge, apiMayaRecharge, apiGCashPayRecharge } from '@/API/common';\nimport { session_token } from '@/API/user';\nexport default {\n  components: {\n    [_Toast.name]: _Toast,\n    [_Popup.name]: _Popup\n  },\n  data() {\n    return {\n      itemName: process.env.VUE_APP_ITEM_NAME,\n      coinList: [],\n      max: '',\n      min: '',\n      form: {\n        currency: '',\n        price: ''\n      },\n      session_token: '',\n      btnDis: true,\n      isGcash: true,\n      showPopup: false,\n      path: ''\n    };\n  },\n  computed: {\n    payName() {\n      return this.$route.query?.type == 'Maya' ? 'Maya' : 'GCash';\n    }\n  },\n  async created() {\n    session_token({}).then(res => {\n      this.session_token = res.session_token;\n    });\n    const {\n      type,\n      min,\n      max\n    } = this.$route.query;\n    this.isGcash = type != 'Bank';\n    if (type == 'Bank') {\n      _Toast.loading({\n        message: this.$t('加载中...'),\n        forbidClick: true,\n        duration: 0\n      });\n      try {\n        const res = await apigetCoinList();\n        this.coinList = res.filter(item => item.productType == type)[0].range;\n        this.form.currency = this.coinList[27].bank_code;\n        this.max = this.coinList[27].max_amount;\n        this.min = this.coinList[27].min_amount;\n        _Toast.clear();\n      } catch (error) {\n        _Toast.clear();\n        this.$router.back();\n      }\n    } else {\n      this.max = max;\n      this.min = min;\n    }\n  },\n  methods: {\n    async onSubmit() {\n      this.$toast.loading();\n      if (this.form.price == '') return this.$notify(this.$t('请输入充值数量'));\n      await session_token({}).then(res => {\n        this.session_token = res.session_token;\n      });\n      if (this.isGcash) {\n        const typeToApiMap = {\n          'GCash2.0': apiGcash2Recharge,\n          'GCash3.0': apiGcash3Recharge,\n          'Maya': apiMayaRecharge,\n          'GCash pay': apiGCashPayRecharge\n        };\n        const requestFn = typeToApiMap[this.$route.query?.type] || apiPhpRecharge;\n        const params = {\n          amount: this.form.price,\n          session_token: this.session_token,\n          token: localStorage.getItem('token')\n        };\n        if (['GCash2.0', 'GCash3.0', 'Maya', 'GCash pay'].includes(this.$route.query?.type)) {\n          params.pageUrl = window.location.href.split('#/')[0] + '#/me';\n        }\n        const path = await requestFn(params);\n        if (window?.plus) {\n          plus.runtime.openURL(encodeURI(path + '?wt=app'));\n        } else {\n          if (this.isIos()) {\n            this.path = path;\n            this.showPopup = true;\n          } else {\n            window.open(path);\n          }\n        }\n      } else {\n        const path = await apiSubmitRecharge({\n          amount: this.form.price,\n          frenchCurrency: this.form.currency,\n          session_token: this.session_token\n        });\n        if (window?.plus) {\n          plus.runtime.openURL(encodeURI(path + '?wt=app'));\n        } else {\n          if (this.isIos()) {\n            this.path = path;\n            this.showPopup = true;\n          } else {\n            window.open(path);\n          }\n        }\n      }\n      this.$toast.clear();\n    },\n    // 判断是否是IOS\n    isIos() {\n      const u = navigator.userAgent;\n      return !!u.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/);\n    },\n    handleChange(val) {\n      this.form.price = '';\n      const tempArr = this.coinList.filter(item => item.bank_code == val);\n      this.max = tempArr[0].max_amount;\n      this.min = tempArr[0].min_amount;\n    },\n    // 申请金额不能大于最大值\n    handleInput() {\n      this.form.price = this.form.price.replace(/[^\\d.]/g, \"\"); // 非数字和小数点替换为空字符串\n      this.form.price = this.form.price.replace(/\\.{2,}/g, \".\"); // 连续出现多个小数点替换为单个小数点\n      this.form.price = this.form.price.replace(/^\\./g, \"\"); // 第一个字符如果是小数点则替换为空字符串\n      this.form.price = this.form.price.replace(\".\", \"$#$\").replace(/\\./g, \"\").replace(\"$#$\", \".\"); // 将第一个小数点替换为$#$，去除所有小数点，再将$#$替换回小数点\n      this.form.price = this.form.price.replace(/^(\\-)*(\\d+)\\.(\\d{0,2}).*$/, \"$1$2.$3\"); // 最多允许输入2位小数\n      if (this.form.price > this.max) {\n        this.form.price = this.max;\n      } else if (this.form.price < 1) {\n        this.form.price = '';\n      }\n      this.btnDis = this.form.price < this.min;\n    },\n    // 申请金额不能小于最小值\n    handleInputChange() {\n      if (this.form.price < this.min) {\n        this.form.price = '';\n        this.$notify(`${this.$t('申请金额不能小于')}${this.min}`);\n        return;\n      }\n      this.form.price = Number(this.form.price).toFixed(2);\n    },\n    // 查询Gcash最大最小值\n    async handleGcashQuery(params) {\n      const data = await apigetCoinList(params);\n      return data[0];\n    },\n    handleAccess() {\n      this.showPopup = false;\n      window.open(this.path);\n    }\n  }\n};","map":{"version":3,"names":["apigetCoinList","apiSubmitRecharge","apiPhpRecharge","apiGcash2Recharge","apiGcash3Recharge","apiMayaRecharge","apiGCashPayRecharge","session_token","components","_Toast","name","_Popup","data","itemName","process","env","VUE_APP_ITEM_NAME","coinList","max","min","form","currency","price","btnDis","isGcash","showPopup","path","computed","payName","$route","query","type","created","then","res","loading","message","$t","forbidClick","duration","filter","item","productType","range","bank_code","max_amount","min_amount","clear","error","$router","back","methods","onSubmit","$toast","$notify","typeToApiMap","requestFn","params","amount","token","localStorage","getItem","includes","pageUrl","window","location","href","split","plus","runtime","openURL","encodeURI","isIos","open","frenchCurrency","u","navigator","userAgent","match","handleChange","val","tempArr","handleInput","replace","handleInputChange","Number","toFixed","handleGcashQuery","handleAccess"],"sources":["src/page/recharge/bankCard/index.vue"],"sourcesContent":["<template>\n    <div class=\"bank_card\">\n        <van-nav-bar safe-area-inset-top fixed :title=\"itemName == 'Hive' ? $t('加值') : $t('充值')\" left-arrow\n            @click-left=\"$router.push({ path: '/rechargeList', dir: 'left' })\" :right-text=\"$t('记录')\"\n            @click-right=\"$router.push({ path: '/rechargeRecord' })\" />\n        <div style=\"width: 100%;\" class=\"h46\"></div>\n        <el-form ref=\"form\" :model=\"form\" label-width=\"80px\">\n            <el-form-item :label=\"$t('选择币种')\" v-if=\"!isGcash\">\n                <el-select v-model=\"form.currency\" :placeholder=\"$t('请选择币种')\" filterable :no-match-text=\"$t('无匹配数据')\"\n                    @change=\"handleChange\">\n                    <el-option v-for=\"item of coinList\" :key=\"item.bank_code\" :label=\"item.bank_code\"\n                        :value=\"item.bank_code\"></el-option>\n                </el-select>\n            </el-form-item>\n            <el-form-item :label=\"$t('充值金额')\">\n                <el-input type=\"number\" step=\"0.01\" v-model=\"form.price\" :placeholder=\"`${min}-${max}`\" @input=\"handleInput\"\n                    @change=\"handleInputChange\" clearable></el-input>\n            </el-form-item>\n        </el-form>\n        <div class=\"btn\">\n            <van-button block type=\"primary\" :disabled=\"btnDis\" @click=\"onSubmit\">{{ $t('确认') }}</van-button>\n        </div>\n        <van-popup v-model=\"showPopup\">\n            <div class=\"popup_wrap\">\n                <div class=\"title\">\n                    {{ $t('请前往') }}{{ payName }}，{{ $t('继续完成支付') }}\n                </div>\n                <div class=\"path\">\n                    {{ path }}\n                </div>\n                <div class=\"btn\">\n                    <van-button type=\"primary\" @click=\"handleAccess\">{{ $t('继续访问') }}</van-button>\n                </div>\n            </div>\n        </van-popup>\n    </div>\n</template>\n<script>\nimport { apigetCoinList, apiSubmitRecharge, apiPhpRecharge, apiGcash2Recharge, apiGcash3Recharge, apiMayaRecharge, apiGCashPayRecharge } from '@/API/common'\nimport { session_token } from '@/API/user'\nimport { Toast, Popup } from 'vant'\nexport default {\n    components: {\n        [Toast.name]: Toast,\n        [Popup.name]: Popup,\n    },\n    data() {\n        return {\n            itemName: process.env.VUE_APP_ITEM_NAME,\n            coinList: [],\n            max: '',\n            min: '',\n            form: {\n                currency: '',\n                price: ''\n            },\n            session_token: '',\n            btnDis: true,\n            isGcash: true,\n            showPopup: false,\n            path: ''\n        }\n    },\n    computed: {\n        payName() {\n            return this.$route.query?.type == 'Maya' ? 'Maya' : 'GCash'\n        }\n    },\n    async created() {\n        session_token({}).then(res => {\n            this.session_token = res.session_token\n        })\n        const { type, min, max } = this.$route.query\n        this.isGcash = type != 'Bank'\n\n        \n        if (type == 'Bank') {\n            Toast.loading({\n                message: this.$t('加载中...'),\n                forbidClick: true,\n                duration: 0\n            });\n            try {\n                const res = await apigetCoinList()\n                this.coinList = res.filter(item => item.productType == type)[0].range\n                this.form.currency = this.coinList[27].bank_code\n                this.max = this.coinList[27].max_amount\n                this.min = this.coinList[27].min_amount\n                Toast.clear()\n            } catch (error) {\n                Toast.clear()\n                this.$router.back()\n            }\n        } else {\n            this.max = max\n            this.min = min\n        }\n    },\n    methods: {\n        async onSubmit() {\n            this.$toast.loading()\n            if (this.form.price == '') return this.$notify(this.$t('请输入充值数量'))\n            await session_token({}).then(res => {\n                this.session_token = res.session_token\n            })\n            if (this.isGcash) {\n                const typeToApiMap = {\n                    'GCash2.0': apiGcash2Recharge,\n                    'GCash3.0': apiGcash3Recharge,\n                    'Maya': apiMayaRecharge,\n                    'GCash pay': apiGCashPayRecharge,\n                };\n                const requestFn = typeToApiMap[this.$route.query?.type] || apiPhpRecharge;\n\n                const params = {\n                    amount: this.form.price,\n                    session_token: this.session_token,\n                    token: localStorage.getItem('token'),\n                }\n                if (['GCash2.0', 'GCash3.0', 'Maya', 'GCash pay'].includes(this.$route.query?.type)) {\n                    params.pageUrl = window.location.href.split('#/')[0] + '#/me'\n                }\n                const path = await requestFn(params)\n                if (window?.plus) {\n                    plus.runtime.openURL(encodeURI(path + '?wt=app'))\n                } else {\n                    if (this.isIos()) {\n                        this.path = path\n                        this.showPopup = true\n                    } else {\n                        window.open(path)\n                    }\n                }\n            } else {\n                const path = await apiSubmitRecharge({\n                    amount: this.form.price,\n                    frenchCurrency: this.form.currency,\n                    session_token: this.session_token\n                })\n                if (window?.plus) {\n                    plus.runtime.openURL(encodeURI(path + '?wt=app'))\n                } else {\n\n                    if (this.isIos()) {\n                        this.path = path\n                        this.showPopup = true\n                    } else {\n                        window.open(path)\n                    }\n                }\n            }\n            this.$toast.clear()\n\n        },\n        // 判断是否是IOS\n        isIos() {\n            const u = navigator.userAgent;\n            return !!u.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/);\n        },\n\n        handleChange(val) {\n            this.form.price = ''\n            const tempArr = this.coinList.filter(item => item.bank_code == val)\n            this.max = tempArr[0].max_amount\n            this.min = tempArr[0].min_amount\n        },\n        // 申请金额不能大于最大值\n        handleInput() {\n            this.form.price = this.form.price.replace(/[^\\d.]/g, \"\"); // 非数字和小数点替换为空字符串\n            this.form.price = this.form.price.replace(/\\.{2,}/g, \".\"); // 连续出现多个小数点替换为单个小数点\n            this.form.price = this.form.price.replace(/^\\./g, \"\"); // 第一个字符如果是小数点则替换为空字符串\n            this.form.price = this.form.price.replace(\".\", \"$#$\").replace(/\\./g, \"\").replace(\"$#$\", \".\"); // 将第一个小数点替换为$#$，去除所有小数点，再将$#$替换回小数点\n            this.form.price = this.form.price.replace(/^(\\-)*(\\d+)\\.(\\d{0,2}).*$/, \"$1$2.$3\"); // 最多允许输入2位小数\n            if (this.form.price > this.max) {\n                this.form.price = this.max\n            } else if (this.form.price < 1) {\n                this.form.price = ''\n            }\n            this.btnDis = this.form.price < this.min\n        },\n        // 申请金额不能小于最小值\n        handleInputChange() {\n            if (this.form.price < this.min) {\n                this.form.price = ''\n                this.$notify(`${this.$t('申请金额不能小于')}${this.min}`)\n                return\n            }\n            this.form.price = Number(this.form.price).toFixed(2)\n        },\n        // 查询Gcash最大最小值\n        async handleGcashQuery(params) {\n            const data = await apigetCoinList(params)\n            return data[0]\n        },\n        handleAccess() {\n            this.showPopup = false\n            window.open(this.path)\n        }\n    }\n}\n\n\n</script>\n\n\n<style lang=\"scss\" scoped>\n.popup_wrap {\n    width: 86vw;\n    padding: 15px;\n    overflow: hidden;\n\n    .title {\n        font-size: 14px;\n        text-align: left;\n        line-height: 28px;\n    }\n\n    .path {\n        font-size: 12px;\n        text-align: left;\n        line-height: 28px;\n        color: #999999;\n        border-bottom: 1px solid #E5E5E5;\n        overflow: hidden;\n\n    }\n\n    .btn {\n        margin-top: 15px;\n        display: flex;\n        justify-content: flex-end;\n        align-items: center;\n    }\n}\n\n.btn {\n    padding: 0 15px;\n}\n\n:deep(.el-form) {\n    padding: 0 15px;\n}\n\n:deep(.el-form-item) {\n    display: flex;\n    flex-direction: column;\n\n    .el-form-item__content {\n        margin: 0 !important;\n    }\n}\n\n:deep(.van-button) {\n    background: var(--main-color);\n}\n\n:deep(.el-form-item__label) {\n    width: 100% !important;\n    text-align: start !important;\n}\n\n:deep(.el-select) {\n    width: 100%;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}