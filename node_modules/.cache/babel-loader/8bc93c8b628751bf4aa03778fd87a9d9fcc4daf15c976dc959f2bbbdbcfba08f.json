{"ast":null,"code":"import \"vant/es/popover/style\";\nimport _Popover from \"vant/es/popover\";\nimport \"vant/es/collapse-item/style\";\nimport _CollapseItem from \"vant/es/collapse-item\";\nimport \"vant/es/collapse/style\";\nimport _Collapse from \"vant/es/collapse\";\nimport \"vant/es/action-sheet/style\";\nimport _ActionSheet from \"vant/es/action-sheet\";\nimport \"vant/es/dialog/style\";\nimport _Dialog from \"vant/es/dialog\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/icon/style\";\nimport _Icon from \"vant/es/icon\";\nimport \"vant/es/popup/style\";\nimport _Popup from \"vant/es/popup\";\nimport \"vant/es/list/style\";\nimport _List from \"vant/es/list\";\nimport \"vant/es/pull-refresh/style\";\nimport _PullRefresh from \"vant/es/pull-refresh\";\nimport \"vant/es/loading/style\";\nimport _loading from \"vant/es/loading\";\nimport \"vant/es/image/style\";\nimport _Image from \"vant/es/image\";\nimport \"vant/es/swipe-item/style\";\nimport _SwipeItem from \"vant/es/swipe-item\";\nimport \"vant/es/swipe/style\";\nimport _Swipe from \"vant/es/swipe\";\nimport \"vant/es/skeleton/style\";\nimport _Skeleton from \"vant/es/skeleton\";\nimport \"vant/es/empty/style\";\nimport _Empty from \"vant/es/empty\";\nimport \"vant/es/tabs/style\";\nimport _Tabs from \"vant/es/tabs\";\nimport \"vant/es/tab/style\";\nimport _Tab from \"vant/es/tab\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport { apiGetCategory, apiCategoryTree } from \"@/API/home\";\nimport { getSellerInfo } from \"@/API/commodity\";\nimport { sellerGoodsList, focusSeller, focusSellerDel, apiSellerTree } from \"@/API/shop\";\nimport { isLogin, priceFormat, getStorage } from \"@/utils/utis\";\nimport GoodInfo from \"@/page/shop/goodInfo.vue\";\nexport default {\n  name: \"shop\",\n  data() {\n    return {\n      showPopover: false,\n      actions123: [{\n        text: this.$t('投诉')\n      }],\n      nq: \"\",\n      activeName: \"\",\n      tab_index: 0,\n      highLow: 1,\n      autoplayTime: 3000,\n      secondaryCategoryId: \"\",\n      tab_nav_list: [this.$t(\"推荐\"), this.$t(\"商品\")],\n      filter_list: [this.$t(\"综合\"), this.$t(\"销量\"), this.$t(\"价格\"), this.$t(\"新品\")],\n      banner: [],\n      loading: false,\n      finished: false,\n      refreshing: false,\n      isLeftShow: false,\n      show: false,\n      popupHeight: 0,\n      filterIndex: 0,\n      searchIcon: require(\"@/assets/image/index/sousuo.png\"),\n      shopBg: require('@/assets/image/shop/bg.png'),\n      SellerInfo: {},\n      list: [],\n      page_no: 0,\n      categoryList: [],\n      categoryId: \"-1\",\n      isPrice: 0,\n      newTime: 0,\n      collectTitle: \"收藏\",\n      isHot: 0,\n      actions: [],\n      isRec: 0,\n      active1: 0,\n      active2: 0,\n      active3: 0,\n      actions1: [{\n        name: this.$t(\"价格由高到低\"),\n        value: 1\n      }, {\n        name: this.$t(\"价格由低到高\"),\n        value: 2\n      }],\n      actions2: [{\n        name: this.$t(\"销售量由高到低\"),\n        value: 1\n      }, {\n        name: this.$t(\"销售量由低到高\"),\n        value: 2\n      }],\n      actions3: [{\n        name: this.$t(\"时间由远到近\"),\n        value: 1\n      }, {\n        name: this.$t(\"时间由近到远\"),\n        value: 2\n      }],\n      shopLoading: {\n        banner: false,\n        avatar: false,\n        list: false\n      },\n      itemName: process.env.VUE_APP_ITEM_NAME\n    };\n  },\n  components: {\n    [_Tab.name]: _Tab,\n    [_Tabs.name]: _Tabs,\n    [_Empty.name]: _Empty,\n    [_Skeleton.name]: _Skeleton,\n    [_Swipe.name]: _Swipe,\n    [_SwipeItem.name]: _SwipeItem,\n    [_Image.name]: _Image,\n    [_loading.name]: _loading,\n    [_PullRefresh.name]: _PullRefresh,\n    [_List.name]: _List,\n    [_Popup.name]: _Popup,\n    [_Icon.name]: _Icon,\n    [_Toast.name]: _Toast,\n    [_Dialog.Component.name]: _Dialog.Component,\n    [_ActionSheet.name]: _ActionSheet,\n    [_Collapse.name]: _Collapse,\n    [_CollapseItem.name]: _CollapseItem,\n    [_Popover.name]: _Popover,\n    GoodInfo\n  },\n  computed: {\n    langIsAr() {\n      return localStorage.getItem('lang') == 'ar';\n    },\n    filterIcons() {\n      const suffix = this.$store.state.multiItem[process.env.VUE_APP_ITEM_NAME].iconSuffix || 'jpg';\n      return {\n        icon1: require(\"@/assets/image/shop/1.jpg\"),\n        icon2: require(`@/assets/${process.env.VUE_APP_ITEM_NAME}/2.${suffix}`),\n        icon3: require(`@/assets/${process.env.VUE_APP_ITEM_NAME}/3.${suffix}`)\n      };\n    }\n  },\n  created() {\n    this.page_no = 0;\n    this.list = [];\n    let lang = this.$route.query?.lang;\n    if (lang) {\n      switch (lang) {\n        case 'zh-CN':\n          lang = 'cn';\n          break;\n        case 'zh-TW':\n        case 'CN':\n          lang = 'tw';\n          break;\n        case 'en-US':\n          lang = 'en';\n          break;\n        default:\n          break;\n      }\n      sessionStorage.setItem('backPath', '/');\n      if (lang !== localStorage.getItem('lang')) {\n        localStorage.setItem('lang', lang);\n        location.reload();\n      }\n    }\n    if (this.$route.query.index) this.tab_index = +this.$route.query.index;\n    this.popupHeight = this.screenHight - 108;\n    this.getSellerInfo(this.$route.query.sellerId);\n    this.home_category();\n    const tempObj = JSON.parse(sessionStorage.getItem(\"shopState\"));\n    if (['Argos', 'ArgosShop'].includes(this.itemName)) {\n      this.filter_list = ['', this.$t('销量'), this.$t('价格'), ''];\n      this.selectIndex({}, 1, 2);\n    } else if (tempObj?.filterIndex) {\n      this.filterIndex = tempObj.filterIndex;\n      this.highLow = tempObj.highLow;\n      this.selectIndex({}, tempObj.filterIndex, tempObj.highLow);\n    } else {\n      setInterval(() => {\n        this.onLoad();\n      }, 1000);\n    }\n  },\n  beforeDestroy() {\n    document.body.style.overflow = 'auto';\n  },\n  mounted() {\n    document.body.style.overflow = 'hidden';\n  },\n  methods: {\n    handleSelect(action) {\n      this.$router.push('/complaint?sellerId=' + this.$route.query.sellerId);\n    },\n    priceFormat(num) {\n      return priceFormat(num);\n    },\n    handleDiglog(text) {\n      if (!text) return;\n      _Dialog.alert({\n        title: this.$t('店铺简介'),\n        confirmButtonText: this.$t('确认'),\n        message: text\n      }).then(() => {\n        // on close\n      });\n    },\n    getList() {\n      this.page_no++;\n      var data = {\n        pageNum: this.page_no,\n        pageSize: 10,\n        sellerId: this.$route.query.sellerId,\n        isPrice: this.isPrice,\n        isNew: this.newTime,\n        isHot: this.isHot,\n        isRec: this.isRec\n      };\n      if (this.tab_index == 0) {\n        data.isRec = '1';\n      } else {\n        delete data.isRec;\n      }\n      if (this.categoryId && this.categoryId != \"-1\") {\n        data.categoryId = this.categoryId;\n      }\n      // if (this.isPrice == 1) {\n      //   data.isPrice = this.isPrice\n      // }\n      // if (this.newTime) {\n      //   data.newTime = this.newTime\n      // }\n      !data.categoryId && delete data.categoryId;\n      !data.isHot && delete data.isHot;\n      !data.isPrice && delete data.isPrice;\n      !data.newTime && delete data.newTime;\n      Object.keys(data).forEach(k => {\n        if (!data[k]) delete data[k];\n      });\n      sellerGoodsList(data).then(res => {\n        // for (let i = 0; i < res.pageList.length; i++) {\n        //     this.list.push(res.pageList[i]);\n        // }\n        this.list.push(...res.pageList);\n        this.loading = false;\n        if (res.pageList.length == 0) {\n          this.finished = true;\n        }\n        this.shopLoading.list = false;\n        var obj = {};\n        this.list = this.list.reduce((prev, cur) => {\n          obj[cur.id] ? \"\" : obj[cur.id] = true && prev.push(cur);\n          return prev;\n        }, []);\n      });\n    },\n    //获取分类\n    home_category() {\n      // apiGetCategory({ sellerId: this.$route.query.sellerId }).then((res) => {\n      //     this.categoryList = res\n      // });\n      apiSellerTree({\n        sellerId: this.$route.query.sellerId\n      }).then(res => {\n        this.categoryList = res;\n        this.categoryList.unshift({\n          name: this.$t(\"全部商品\"),\n          categoryId: \"-1\",\n          subList: []\n        });\n        // .filter(item => {\n        //     if (item.name && item.subList.length > 0) {\n        //         item.subList = item.subList.filter(subItem => subItem.name);\n        //     }\n        //     return item.name;\n        // });\n      });\n    },\n    selectCategory(item, sub) {\n      if (item.name == this.$t('全部商品')) {\n        this.activeName = '';\n      }\n      if (item.categoryId == '-1') {\n        this.refreshing = true;\n        this.page_no = 0;\n        this.categoryId = '-1';\n        this.secondaryCategoryId = '';\n        this.isLeftShow = false;\n        this.onLoad();\n        document.body.scrollTop = 0;\n        document.documentElement.scrollTop = 0;\n        return;\n      }\n      this.isLoading = true;\n      this.page_no = 0;\n      this.list = [];\n      this.categoryId = item?.categoryId;\n      if (sub) this.secondaryCategoryId = sub.categoryId;else this.secondaryCategoryId = '';\n      this.isLeftShow = false;\n      this.onLoad();\n      document.body.scrollTop = 0;\n      document.documentElement.scrollTop = 0;\n    },\n    //关注店铺\n    addFocusSeller() {\n      if (!isLogin()) {\n        // Toast(this.$t(\"请先登录\"));\n        // Dialog.confirm({\n        //     title: this.$t(\"您还未登录\"),\n        //     message: this.$t(\"是否跳转到登录页面\"),\n        //     confirmButtonText: this.$t(\"确认\"),\n        //     cancelButtonText: this.$t(\"取消\"),\n        // }).then(() => {\n        //     this.$router.push(\"/login\");\n        // });\n        this.$notifyWarn(this.$t(\"请先登录\"));\n        this.$router.push(\"/login\");\n        return;\n      }\n      if (this.SellerInfo?.isFocus == 1) {\n        this.delFocusSeller();\n      } else {\n        let data = {\n          sellerId: this.$route.query.sellerId\n        };\n        focusSeller(data).then(() => {\n          this.collectTitle = \"已收藏\";\n          this.SellerInfo.isFocus = 1;\n          _Toast(this.$t(\"关注成功\"));\n        });\n      }\n    },\n    //取消关注\n    delFocusSeller() {\n      let data = {\n        sellerId: this.$route.query.sellerId\n      };\n      focusSellerDel(data).then(() => {\n        this.SellerInfo.isFocus = 0;\n        this.collectTitle = \"收藏\";\n        _Toast(this.$t(\"取消成功\"));\n      });\n    },\n    onSelect(item) {\n      item.value = item.value === 1 ? 2 : 1;\n      if (this.filterIndex == 1) {\n        this.isPrice = 0;\n        this.isHot = item.value;\n        this.newTime = 0;\n      } else if (this.filterIndex == 2) {\n        this.isPrice = item.value;\n        this.isHot = 0;\n        this.newTime = 0;\n      } else {\n        this.isPrice = 0;\n        this.isHot = 0;\n        this.newTime = item.value;\n      }\n      this.page_no = 0;\n      this.list = [];\n      this.onLoad();\n      document.body.scrollTop = 0;\n      document.documentElement.scrollTop = 0;\n    },\n    onCancel() {\n      if (this.filterIndex == 1) {\n        this.actions1.map(info => {\n          info.color = \"\";\n        });\n        this.isPrice = 0;\n      } else if (this.filterIndex == 2) {\n        this.actions2.map(info => {\n          info.color = \"\";\n        });\n        this.isHot = 0;\n      } else {\n        this.actions3.map(info => {\n          info.color = \"\";\n        });\n        this.newTime = 0;\n      }\n      this.page_no = 0;\n      this.list = [];\n      this.onLoad();\n      document.body.scrollTop = 0;\n      document.documentElement.scrollTop = 0;\n    },\n    selectIndex(item, index, highLow) {\n      this.shopLoading.list = true;\n      if (!highLow) {\n        if (this.filterIndex === index) {\n          this.highLow = this.highLow === 2 ? 3 : this.highLow === 3 ? 2 : 2;\n        } else {\n          this.highLow = 2;\n        }\n      } else {\n        this.highLow = highLow;\n      }\n      this.filterIndex = index;\n      if (index == 1) {\n        this.actions = this.actions2;\n        this.onSelect({\n          value: this.highLow - 1\n        });\n      } else if (index == 2) {\n        this.actions = this.actions1;\n        this.onSelect({\n          value: this.highLow - 1\n        });\n      } else if (index == 3) {\n        this.actions = this.actions3;\n        this.onSelect({\n          value: this.highLow - 1\n        });\n      } else {\n        this.isPrice = 0;\n        this.newTime = '';\n        this.isPrice = 0;\n        this.newTime = 0;\n        this.isHot = 0;\n        this.page_no = 0;\n        this.list = [];\n        this.onLoad();\n        document.body.scrollTop = 0;\n        document.documentElement.scrollTop = 0;\n      }\n      this.filterIndex = index;\n      sessionStorage.setItem(\"shopState\", JSON.stringify({\n        filterIndex: this.filterIndex,\n        highLow: this.highLow\n      }));\n    },\n    onClickLeft() {\n      const backPath = sessionStorage.getItem(\"backPath\");\n      if (backPath) {\n        this.$router.replace('/');\n        sessionStorage.removeItem(\"backPath\");\n      } else {\n        this.$router.go(-1);\n      }\n    },\n    handleChange(index) {\n      this.isLeftShow = false;\n      this.$router.replace({\n        query: {\n          ...this.$route.query,\n          index\n        }\n      });\n      this.shopLoading.list = true;\n      this.list = [];\n      // if (index == this.tab_index) return;\n      // index == 0 ? (this.isRec = \"1\") : (this.isRec = \"0\");\n      this.tab_index = index;\n      this.categoryId = undefined;\n      this.isPrice = undefined;\n      this.newTime = 0;\n      this.filterIndex = 0;\n      this.page_no = 0;\n      const tempObj = JSON.parse(sessionStorage.getItem(\"shopState\"));\n      if (['Argos', 'ArgosShop'].includes(this.itemName)) {\n        this.filter_list = ['', this.$t('销量'), this.$t('价格'), ''];\n        this.selectIndex({}, 1, 2);\n      } else if (tempObj?.filterIndex) {\n        this.filterIndex = tempObj.filterIndex;\n        this.highLow = tempObj.highLow;\n        this.selectIndex({}, tempObj.filterIndex, tempObj.highLow);\n      } else {\n        this.onLoad();\n      }\n    },\n    // 商家详情\n    getSellerInfo(id) {\n      let dataJson = {\n        sellerId: id\n      };\n      getSellerInfo(dataJson).then(res => {\n        this.SellerInfo = res;\n        this.collectTitle = this.SellerInfo?.isFocus == 1 ? \"已收藏\" : \"收藏\";\n        if (res.banner1) {\n          this.banner.push(res.banner1);\n          this.autoplayTime = 0;\n        }\n        if (res.banner2) {\n          this.banner.push(res.banner2);\n          this.autoplayTime = 3000;\n        }\n        if (res.banner3) {\n          this.banner.push(res.banner3);\n          this.autoplayTime = 3000;\n        }\n        this.shopLoading.banner = this.shopLoading.avatar = false;\n      });\n    },\n    onRefresh() {\n      // 清空列表数据\n      this.finished = false;\n      this.page_no = 0;\n      // 重新加载数据\n      // 将 loading 设置为 true，表示处于加载状态\n      this.loading = true;\n      this.onLoad();\n    },\n    onLoad() {\n      if (this.refreshing) {\n        this.list = [];\n        this.refreshing = false;\n      }\n      this.getList();\n    },\n    openDetails(item) {\n      document.body.scrollTop = 0;\n      document.documentElement.scrollTop = 0;\n      this.$router.push(\"/CommodityDetails?sellerGoodsId=\" + item.id);\n    },\n    openUrl(url, name) {\n      !url && _Toast(this.$t(\"该商户未开通\") + \" \" + name);\n      url && (location.href = url);\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}