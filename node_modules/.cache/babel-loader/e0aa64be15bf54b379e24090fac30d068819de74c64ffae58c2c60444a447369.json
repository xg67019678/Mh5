{"ast":null,"code":"import \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/uploader/style\";\nimport _Uploader from \"vant/es/uploader\";\nimport \"vant/es/icon/style\";\nimport _Icon from \"vant/es/icon\";\nimport \"core-js/modules/es.array.push.js\";\nimport QRCode from 'qrcode';\nimport { priceFormat } from '@/utils/utis';\nimport { chongzhitijiao_post, session_token, tupianshangchuan_post, zhifutongdao_post } from \"@/API/user\";\nexport default {\n  data() {\n    return {\n      priceFormat,\n      itemName: process.env.VUE_APP_ITEM_NAME,\n      data: {},\n      codes: '',\n      tongdao_xuanzhong: {},\n      imgUrl: null,\n      tongdao: [],\n      it: {\n        input1: ''\n      },\n      fileList: [],\n      shangchuanurl: '',\n      session_token: ''\n    };\n  },\n  components: {\n    QRCode: QRCode,\n    [_Icon.name]: _Icon,\n    [_Uploader.name]: _Uploader\n  },\n  created() {\n    // this.$nextTick(function () {\n    //   this.useqrcode1()\n    // })\n    // this.useqrcode1()\\\n    this.zhifutongdao();\n  },\n  methods: {\n    handleInput() {\n      this.it.input1 = this.it.input1.replace(/[^\\d.]/g, \"\"); // 非数字和小数点替换为空字符串\n      this.it.input1 = this.it.input1.replace(/\\.{2,}/g, \".\"); // 连续出现多个小数点替换为单个小数点\n      this.it.input1 = this.it.input1.replace(/^\\./g, \"\"); // 第一个字符如果是小数点则替换为空字符串\n      this.it.input1 = this.it.input1.replace(\".\", \"$#$\").replace(/\\./g, \"\").replace(\"$#$\", \".\"); // 将第一个小数点替换为$#$，去除所有小数点，再将$#$替换回小数点\n      if (['BTC', 'ETH'].includes(this.$route.query.type)) {\n        this.it.input1 = this.it.input1.replace(/^(\\-)*(\\d+)\\.(\\d{0,10}).*$/, \"$1$2.$3\"); // 最多允许输入10位小数\n        this.it.input1 = this.it.input1.replace(/^\\D*(\\d{0,10}(?:\\.\\d{0,10})?).*$/g, \"$1\"); // 最多允许输入10位数字\n      } else {\n        this.it.input1 = this.it.input1.replace(/^(\\-)*(\\d+)\\.(\\d{0,2}).*$/, \"$1$2.$3\"); // 最多允许输入2位小数\n        // this.it.input1 = this.it.input1.replace(/^\\D*(\\d{0,2}(?:\\.\\d{0,10})?).*$/g, \"$1\"); // 最多允许输入10位数字\n      }\n    },\n    biaodan_tijiao() {\n      var t = this;\n      if (this.it.input1 === '') {\n        _Toast(t.$t('请输入充值数量'));\n        return;\n      }\n      if (this.shangchuanurl === '') {\n        _Toast(t.$t('请上传图片'));\n        return;\n      }\n      if ((this.it.input1 * this.tongdao_xuanzhong.fee).toFixed(2) < this.tongdao_xuanzhong.recharge_limit_min) {\n        _Toast(t.$t('充值价值不得小于最小限额') + this.tongdao_xuanzhong.recharge_limit_min + 'usdt');\n        return;\n      }\n      if ((this.it.input1 * this.tongdao_xuanzhong.fee).toFixed(2) > this.tongdao_xuanzhong.recharge_limit_max) {\n        _Toast(t.$t('充值价值不得大于最大限额') + this.tongdao_xuanzhong.recharge_limit_max + 'usdt');\n        return;\n      }\n      session_token({}).then(res => {\n        this.session_token = res.session_token;\n        this.chongzhitijiao();\n      });\n    },\n    chongzhitijiao() {\n      var data = {\n        'session_token': this.session_token,\n        'amount': this.it.input1,\n        'from': '123',\n        'blockchain_name': this.tongdao_xuanzhong.blockchain_name,\n        'img': this.shangchuanurl,\n        'coin': this.tongdao_xuanzhong.coin,\n        'channel_address': this.tongdao_xuanzhong.address,\n        'tx': '123'\n      };\n      _Toast.loading({\n        duration: 0,\n        forbidClick: true,\n        loadingType: \"spinner\",\n        message: \"\"\n      });\n      chongzhitijiao_post(data).then(res => {\n        _Toast.clear();\n        _Toast(this.$t('提交成功'));\n        this.it.input1 = '';\n        this.fileList = [];\n        this.shangchuanurl = '';\n        this.$router.push('/SubmitCompleted?path=rechargeRecord');\n      }).catch(err => {\n        // Toast.clear()\n        // reject(err)\n        _Toast.clear();\n        // Toast(this.$t(err.msg));\n      });\n    },\n    tongdao_qiehuan(e) {\n      this.tongdao_xuanzhong = e;\n      this.useqrcode1();\n    },\n    zhifutongdao() {\n      zhifutongdao_post({}).then(res22 => {\n        // this.code = this.$route.query.usercode\n\n        for (var i = 0; i < res22.length; i++) {\n          if (res22[i]['coin'] === this.$route.query.type) {\n            this.tongdao.push(res22[i]);\n          }\n        }\n        this.tongdao_xuanzhong = this.tongdao[0];\n        this.useqrcode1();\n      });\n    },\n    afterRead(file) {\n      _Toast.loading({\n        duration: 0,\n        forbidClick: true,\n        loadingType: \"spinner\",\n        message: \"\"\n      });\n      let formData = new FormData(); //通过formdata上传\n      formData.append('file', file.file);\n      formData.append('moduleName', \"recharge\");\n      tupianshangchuan_post(formData).then(res => {\n        _Toast.clear();\n        this.shangchuanurl = res;\n      }).catch(function (err) {\n        _Toast.clear();\n        _Toast(this.$t('添加失败'));\n        this.fileList = [];\n      });\n    },\n    copyData(ea) {\n      //如果需要回调：\n      this.$copyText(ea).then(e => {\n        _Toast(this.$t('复制成功'));\n      }, function (e) {\n        _Toast(this.$t('复制失败'));\n      });\n    },\n    copyData2(ea) {\n      //如果需要回调：\n      this.$copyText(ea).then(e => {\n        // alert('复制成功')\n      }, function (e) {\n        // alert('复制失败')\n      });\n    },\n    useqrcode1() {\n      //生成二维码\n      let canvas = document.getElementById('canvas');\n      let url = this.tongdao_xuanzhong.address;\n      QRCode.toCanvas(canvas, url, function (error) {\n        if (error) {} else {}\n      });\n      this.saveImg(); //保存图片\n    },\n    baocunhaibao() {\n      let myCanvas = document.getElementsByTagName('canvas');\n      this.imgUrl = myCanvas[0].toDataURL('image/png');\n      this.getUrlBase64(this.imgUrl).then(base64 => {\n        let link = document.createElement('a');\n        link.href = base64;\n        link.download = 'qrCode.png';\n        link.click();\n      });\n    },\n    getUrlBase64(url) {\n      return new Promise(resolve => {\n        let canvas = document.createElement('canvas');\n        let ctx = canvas.getContext('2d');\n        let img = new Image();\n        img.crossOrigin = 'Anonymous'; //允许跨域\n        img.src = url;\n        img.onload = function () {\n          canvas.height = 300;\n          canvas.width = 300;\n          ctx.drawImage(img, 0, 0, 300, 300);\n          let dataURL = canvas.toDataURL('image/png');\n          canvas = null;\n          resolve(dataURL);\n        };\n      });\n    },\n    //保存图片\n    saveImg() {\n      let myCanvas = document.getElementsByTagName('canvas');\n      this.imgUrl = myCanvas[0].toDataURL('image/png');\n    },\n    onClickLeft() {\n      this.$router.push({\n        path: '/rechargeList',\n        dir: 'left'\n      });\n    },\n    onClick1() {\n      this.$router.push({\n        path: '/rechargeRecord'\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}