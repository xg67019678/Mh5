{"ast":null,"code":"import \"vant/es/uploader/style\";\nimport _Uploader from \"vant/es/uploader\";\nimport \"vant/es/rate/style\";\nimport _Rate from \"vant/es/rate\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/nav-bar/style\";\nimport _NavBar from \"vant/es/nav-bar\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { orderListGoods, orderEvaluationAdd } from '@/API/user';\nimport { priceFormat } from '@/utils/utis';\nimport { uploadimg } from \"@/API/commodity\";\nexport default {\n  name: 'OrderEvaluate',\n  components: {\n    [_NavBar.name]: _NavBar,\n    [_Toast.name]: _Toast,\n    [_Rate.name]: _Rate,\n    [_Uploader.name]: _Uploader\n  },\n  data() {\n    return {\n      mainColor: process.env.VUE_APP_MAIN_COLOR,\n      fileList: [],\n      cancelShow: false,\n      remindShow: false,\n      currentData: null,\n      orderId: null,\n      goodsData: []\n    };\n  },\n  mounted() {\n    this.$nextTick(() => {\n      const {\n        id\n      } = this.$route.query;\n      if (id) {\n        this.orderId = id;\n        this.getOrderGoods();\n      } else {\n        _Toast(this.$t('订单号不存在'));\n        setTimeout(() => {\n          this.$router.back();\n        }, 1500);\n      }\n    });\n  },\n  methods: {\n    afterRead(file, {\n      name\n    }) {\n      // if('[object Array]' == Object.prototype.toString.call(file)) {\n\n      // }\n      let index = this.goodsData[name].fileList.length; // 图片的索引\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('上传中'),\n        forbidClick: true\n      });\n      let formData = new FormData(); //通过formdata上传\n      formData.append('file', file.file);\n      formData.append('moduleName', 'selle');\n      let goodsId = '';\n      uploadimg(formData).then(data => {\n        console.log('图片上传成功', data);\n        // this.ruleForm.idimg_2 = data\n        this.goodsData[name][`imgUrl${index}`] = data; //待提交图片的索引\n      }).catch(error => {\n        this.fileList = [];\n        // Toast.fail(this.$t('上传失败'));\n        this.$notify(this.$t('上传失败'));\n      }).finally(() => {\n        _Toast.clear();\n      });\n    },\n    priceFormat(num) {\n      return priceFormat(num);\n    },\n    getOrderGoods() {\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('请求中'),\n        forbidClick: true\n      });\n      orderListGoods({\n        orderId: this.orderId\n      }).then(res => {\n        const data = res.pageList || [];\n        data.forEach(item => {\n          item.rating = 5;\n          item.content = '';\n        });\n        this.goodsData = data;\n        _Toast.clear();\n      }).catch(() => {\n        _Toast.clear();\n      });\n    },\n    async submitHandle() {\n      const dataArr = this.goodsData.map(item => {\n        const {\n          rating,\n          content,\n          goodsId\n        } = item;\n        let evaluationType = '1';\n        if (rating < 2) {\n          evaluationType = '3';\n        } else if (rating < 4) {\n          evaluationType = '2';\n        } else {\n          evaluationType = '1';\n        }\n        let obj = {\n          orderId: this.orderId,\n          sellerGoodsId: goodsId,\n          rating,\n          content,\n          evaluationType\n        };\n        Object.keys(item).forEach(key => {\n          if (key.indexOf('imgUrl') !== -1) {\n            obj[key] = item[key];\n          }\n        });\n        return obj;\n      });\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('提交中'),\n        forbidClick: true\n      });\n      for (let i = 0; i < dataArr.length; i++) {\n        await orderEvaluationAdd(dataArr[i]);\n      }\n      _Toast.success(this.$t('成功'));\n      setTimeout(() => {\n        this.$router.back();\n      }, 1000);\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}